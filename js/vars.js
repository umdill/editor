// CLONING UPDATE ADDED :)

const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),controls=[localStorage.getItem("up")??"w",localStorage.getItem("left")??"a",localStorage.getItem("down")??"s",localStorage.getItem("right")??"d"],types=["text","hatReward","reward","gravityZone","image1","block1","turret","turretRegion","image0","block0","spawner","door","switch","button","circularSlime","slime","movingSlime","circularIce","ice","movingIce","circularLava","rotLavaPoint","rotatingLava","movingLava","lava","teleporter","circularObstacle","obstacle","movingObstacle"];function getObjects(e="obstacle"){return"block0"===e?currentArea.objects.block.filter(e=>!e.layer):"block1"===e?currentArea.objects.block.filter(e=>e.layer):"rotLavaPoint"===e?currentArea.objects.rotatingLava.map(e=>e.point):"circularObstacle"===e?currentArea.objects.circularObject.filter(e=>"obstacle"===e.objectType):"circularLava"===e?currentArea.objects.circularObject.filter(e=>"lava"===e.objectType):"circularSlime"===e?currentArea.objects.circularObject.filter(e=>"slime"===e.objectType):"circularIce"===e?currentArea.objects.circularObject.filter(e=>"ice"===e.objectType):"turretRegion"===e?currentArea.objects.turret.includes(selectedObject)?[selectedObject.region]:[]:"movingObstacle"===e?currentArea.objects.movingObject.filter(e=>"obstacle"===e.objectType):"movingLava"===e?currentArea.objects.movingObject.filter(e=>"lava"===e.objectType):"movingSlime"===e?currentArea.objects.movingObject.filter(e=>"slime"===e.objectType):"movingIce"===e?currentArea.objects.movingObject.filter(e=>"ice"===e.objectType):e in currentArea.objects?currentArea.objects[e]:[]}const renderSettings={render:{obstacle:!0,lava:!0,slime:!0,ice:!0,spawner:!0,block0:!0,text:!0,teleporter:!0,block1:!0,hitbox:!0,teleporterHitbox:!1},colors:{obstacle:"rgb(48, 56, 117.6)",lava:"#d01000",slime:"#00c000",ice:"#00ffff",point:"#000000",box:"#00000060",hitbox:"#ffff00",teleporterHitbox:"#0000ffc0",selected:"#ff0000",gravOutline:["#ffff00","#ff0000","#0000ff","#00ff00","#000000"],gravFill:["#ffff0008","#ff000008","#0000ff08","#00ff0008","#00000008"],button:"#404040",buttonPressed:"#505050",doorClosedOutline:"#404040",doorFill:"#404040c0",doorOpenedOutline:"#40404080",doorLineOn:"#ffff0040",doorLineOff:"#40404040",turretBody:"#404040",turretRegion:"#ff000040",spawner:"#00004040",mineRegion:"#00000010",mineExpRegion:"#d0100010",followingRegion:"#00000010",contracRegion:"#8080a010",contracTriggerRegion:"#c000c010",playerDead:"#ff0000",playerFreeze:"#00ffff",playerFreezeDead:"#ff0080",meteor:"#c08000e0",ghost:"#20a040e0",blueFire:"#4040ff10",shield:"#383838e0",frost:"#00ffff40",tail:"#d0a020e0",dash:"#00ffc0c0",shrink:"#b000ff",bombParticle:"#d0100010",explosion:"#00000008",ghostParticles:"#40a040c0",refuel:"#ffff00c0",jetpack:"#c0c0c020"},textures:{enemies:{bouncer:loadImage("enemies/bouncer.svg"),megaBouncer:loadImage("enemies/megabouncer.svg"),freezer:loadImage("enemies/freezer.svg"),spike:loadImage("enemies/spike.svg"),normal:loadImage("enemies/normal.svg"),reverse:loadImage("enemies/reverse.svg"),rotating:loadImage("enemies/rotating.svg"),bomb:[loadImage("enemies/bomb0.svg"),loadImage("enemies/bomb1.svg")],contractor:[loadImage("enemies/contractor0.svg"),loadImage("enemies/contractor1.svg")],taker:loadImage("enemies/taker.svg"),immune:loadImage("enemies/immune.svg"),monster:loadImage("enemies/monster.svg"),following:loadImage("enemies/following.svg"),stutter:loadImage("enemies/stutter.svg"),snekHead:loadImage("enemies/snekHead.svg"),snekBody:loadImage("enemies/snekBody.svg"),wavy:loadImage("enemies/wavy.svg"),shooter:loadImage("enemies/shooter.svg"),expander:loadImage("enemies/expander.svg"),gravityUp:loadImage("enemies/gravityUp.svg"),gravityDown:loadImage("enemies/gravityDown.svg"),gravityLeft:loadImage("enemies/gravityLeft.svg"),gravityRight:loadImage("enemies/gravityRight.svg"),harmless:loadImage("enemies/harmless.svg"),accelerator:loadImage("enemies/accelerator.svg"),decelerator:loadImage("enemies/decelerator.svg"),drainer:loadImage("enemies/drainer.svg"),disabler:loadImage("enemies/disabler.svg"),none:loadImage("enemies/none.svg")},hats:{none:{offset:[0,0],textOffset:-1.3,size:[0,0],texture:loadImage("https://skap.io/textures/hats/none.png")},catEars:{offset:[-1.09,-2],textOffset:-1.6,size:[2.2,2.2],texture:loadImage("https://skap.io/textures/hats/catEars.png")},tophat:{offset:[-1.3,-2.4],textOffset:-2.4,size:[2.6,2.6],texture:loadImage("https://skap.io/textures/hats/topHat.png")},guest:{offset:[0,0],textOffset:-1.3,size:[0,0],texture:loadImage("https://skap.io/textures/hats/none.png")},santa:{offset:[-1.3,-2.4],textOffset:-1.9,size:[3.2,3.2],texture:loadImage("https://skap.io/textures/hats/santa.png")},militaryHat:{offset:[-1.55,-2],textOffset:-1.9,size:[3,3],texture:loadImage("https://skap.io/textures/hats/militaryHat.png")},nookyHat:{offset:[-1.2,-2.8],textOffset:-1.6,size:[2.6,2.6],texture:loadImage("https://skap.io/textures/hats/nookyHat.png")},ravelHat:{offset:[-1.2,-2.8],textOffset:-3,size:[2.6,2.6],texture:loadImage("https://skap.io/textures/hats/eggplant.png")},wolf:{offset:[-1.5,-2],textOffset:-2.2,size:[3,3],texture:loadImage("https://skap.io/textures/hats/wolf.png")},trumpHat:{offset:[-1.53,-2.1],textOffset:-1.7,size:[3.2,3.2],texture:loadImage("https://skap.io/textures/hats/trumpHat1.png")},bunnyEars:{offset:[-1.4,-3],textOffset:-2.2,size:[3,3],texture:loadImage("https://skap.io/textures/hats/bunnyEars.png")},crown:{offset:[-1.55,-2.65],textOffset:-2.2,size:[3.2,3.2],texture:loadImage("https://skap.io/textures/hats/crown.png")},kite:{offset:[-.8,-.8],textOffset:-1.3,size:[1.6,1.6],texture:loadImage("https://skap.io/textures/hats/kite.png")},onigiri:{offset:[-1.05,-1.9],textOffset:-2.5,size:[2.1,2.1],texture:loadImage("https://skap.io/textures/hats/onigiri.png")},taria:{offset:[-1.34,-2.1],textOffset:-2.5,size:[2.7,2.7],texture:loadImage("https://skap.io/textures/hats/taria.png")},horns:{offset:[-1.8,-2],textOffset:-1.5,size:[3.5,3.5],texture:loadImage("https://skap.io/textures/hats/horns.png")},devil:{offset:[-1.8,-2],textOffset:-1.5,size:[3.5,3.5],texture:loadImage("https://skap.io/textures/hats/devil.png")},sakura:{offset:[-1.05,-1.4],textOffset:-1.3,size:[2,2],texture:loadImage("https://skap.io/textures/hats/sakura.png")},cowboy:{offset:[-1.6,-2.4],textOffset:-2,size:[3.2,3.2],texture:loadImage("https://skap.io/textures/hats/cowboy.png")},party:{offset:[-1.36,-2.1],textOffset:-2.4,size:[2.65,2.65],texture:loadImage("https://skap.io/textures/hats/party.png")},bimbo:{offset:[-1.2,-1.8],textOffset:-1.5,size:[2.4,2.4],texture:loadImage("https://skap.io/textures/hats/bimbo.png")},uwu:{offset:[-2.8,-3.5],textOffset:-2.4,size:[5.6,5.6],texture:loadImage("https://skap.io/textures/hats/wowo.png")},flowerHat:{offset:[-1.55,-2.4],textOffset:-2.1,size:[3.2,3.2],texture:loadImage("https://skap.io/textures/hats/flowerHat.png")},solar:{offset:[-1.2,-2.8],textOffset:-5,size:[2.4,2.4],texture:loadImage("/assets/sktextures/hats/solar.png")}},powers:[loadImage("https://skap.io/textures/powers/shrinker.svg"),loadImage("https://skap.io/textures/powers/explosion.svg"),loadImage("https://skap.io/textures/powers/build.svg"),loadImage("https://skap.io/textures/powers/meteor.svg"),loadImage("https://skap.io/textures/powers/refuel.svg"),loadImage("https://skap.io/textures/powers/feather.svg"),loadImage("https://skap.io/textures/powers/shield.svg"),loadImage("https://skap.io/textures/powers/dash.svg"),loadImage("https://skap.io/textures/powers/lantern.svg"),loadImage("https://skap.io/textures/powers/ghost.svg"),loadImage("https://skap.io/textures/powers/frost.svg"),loadImage("https://skap.io/textures/powers/shell.svg"),loadImage("none.svg")]}};let timeOnEnter=Date.now();const randomMapNames=["editor test","My Map","EPIC MAP","{{map->name}}"],randomMapCreators=["anonymous","xXDark_L0rd_69420Xx","Editor","{{map->creator}}"],map={settings:{name:"",creator:"",spawnPos:[50,50],spawnArea:"Home",version:null,skapclient_version:null},areas:[]};{let e=["Scroll on numbers to increment"],t=Math.floor(Math.random()*e.length);document.getElementById("tip").innerHTML=`Tip ${t+1}: ${e[t]}`}let camScale=5;const camSpeed=10;let camX=50,camY=50,selectedObject=null,currentArea=null;const selectBuffer=5;let selectMode=null,lockCursor=!1;const menu=document.getElementById("menu"),areamenu=document.getElementById("areamenu"),objectmenu=document.getElementById("objectmenu"),togglemenu=document.getElementById("togglemenu"),resizemenu=document.getElementById("resizemenu");let resizing=!1;const downloadBtn=document.getElementById("download"),importInput=document.getElementById("import"),obstacleBtn=document.getElementById("createObstacle"),lavaBtn=document.getElementById("createLava"),slimeBtn=document.getElementById("createSlime"),iceBtn=document.getElementById("createIce"),contextmenu=document.getElementById("contextmenu"),contextBtns={obstacle:document.getElementById("createObstacleFromContext"),lava:document.getElementById("createLavaFromContext"),slime:document.getElementById("createSlimeFromContext"),ice:document.getElementById("createIceFromContext"),block:document.getElementById("createBlock"),teleporter:document.getElementById("createTeleporter"),text:document.getElementById("createText"),spawner:document.getElementById("createSpawner"),gravZone:document.getElementById("createGravZone"),rotLava:document.getElementById("createRotLava"),cirObj:document.getElementById("createCirObj"),door:document.getElementById("createDoor"),switch:document.getElementById("createSwitch"),button:document.getElementById("createButton"),turret:document.getElementById("createTurret"),movObj:document.getElementById("createMovObj"),area:document.getElementById("createArea"),deleteArea:document.getElementById("deleteArea"),resetTime:document.getElementById("resetTime"),objectActions:document.getElementById("objectActions"),deleteObject:document.getElementById("deleteObject")},togglebottommenu=document.getElementById("togglebottommenu"),bottommenu=document.getElementById("bottommenu"),areaList=document.getElementById("areaList");function loadImage(e){let t=new Image;return t.src=e.startsWith("http")?e:e.startsWith("/")?e:`../Textures/${e}`,t.onerror=()=>{console.log("ERROR AT",t.src)},t}function htmlspecialchars(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function hexToArr(e){return[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)]}function arrtoRGBA(e){return`rgba(${e.join()})`}function fillZeros(e="0",t=2,a="0"){return a.repeat(t-e.length)+e}function arrtoHex(e){return`#${fillZeros(e[0].toString(16))}${fillZeros(e[1].toString(16))}${fillZeros(e[2].toString(16))}`}function blend240([e,t,a],s){return"rgb("+(240+(e-240)*s)+","+(240+(t-240)*s)+","+(240+(a-240)*s)+")"}let clipboard=null,mousePos={x:0,y:0};function clone(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e.getTime());if(Array.isArray(e))return e.map(clone);let t={};for(let a in e)e.hasOwnProperty(a)&&(t[a]=clone(e[a]));return t}let nextId=1;function newId(){return Date.now()+nextId++}function cloneObject(e){let t=clone(e);return"teleporter"===t.type&&(t.id=newId()),"movingObject"===t.type&&t.points&&(t.points=t.points.map(e=>({x:e.x,y:e.y,vel:e.vel}))),t}